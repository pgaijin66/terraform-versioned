## Usage

To use this module you need to provide 4 inputs : `api_template_file`, `api_template_vars`, `name`, and `stage_name`.

The `api_template` is the name of a YAML file that contains the complete OpenAPI template spec for your REST API Gateway. Within that YAML file, you can reference a variable eg `foo`.
Then, in your module, you can specify the value of `foo` inside of `api_template_vars`.

The `name` and `stage_name` variables are used to define the name of the API Gateway and [Stage](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-basic-concept.html) 
you wish to provision.

## Examples

Assuming that you have some pre-defined variables, your main module may be specified as:

```hcl
module "apigateway_test" {
  source = "github.com/capsulehealth/terraform-modules-sre/region/apigateway"

  name         = "test_apigateway"
  api_template_file = file("${path.module}/example.yml")
  api_template_vars = {
    foo        = "bar"
    name       = "test_apigateway"
    region     = "us-east-1"
    account_id = data.aws_caller_identity.this.account_id
    lambda_arn = data.aws_lambda_function.this.arn
  }

  stage_name = "dev"
  
  capsule_env     = "dev"
  capsule_team    = "test_team"
  capsule_service = "test_service"

  vanta_owner            = "test_team"
  vanta_description      = "test apigateway"
  vanta_user_data        = false
  vanta_user_data_stored = ""
  vanta_contains_ephi    = false
}
```

Then, the YAML file referenced in your module (`example.yml`) can have references to the 5 variables that you're definining above, eg:

```yaml
...
info:
  title: ${name}-${foo}
paths:
  /test:
      ...
      x-amazon-apigateway-integration:
        type: aws
        credentials: arn:aws:iam::${account_id}:role/kinesis-gateway
        uri: arn:aws:apigateway:${region}:lambda:path/2015-03-31/functions/${lambda_arn}/invocations
...
```

<!-- BEGIN_TF_DOCS -->
## Requirements

No requirements.

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | n/a |
| <a name="provider_template"></a> [template](#provider\_template) | n/a |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [aws_api_gateway_api_key._](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_api_key) | resource |
| [aws_api_gateway_deployment._](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_deployment) | resource |
| [aws_api_gateway_rest_api._](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_rest_api) | resource |
| [aws_api_gateway_stage.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage) | resource |
| [aws_api_gateway_usage_plan._](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_usage_plan) | resource |
| [aws_api_gateway_usage_plan_key.main](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_usage_plan_key) | resource |
| [aws_lambda_permission.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_permission) | resource |
| [template_file._](https://registry.terraform.io/providers/hashicorp/template/latest/docs/data-sources/file) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_api_key_description"></a> [api\_key\_description](#input\_api\_key\_description) | The API key description, defaults to 'Managed by Terraform' - string value | `string` | `null` | no |
| <a name="input_api_key_enabled"></a> [api\_key\_enabled](#input\_api\_key\_enabled) | Specifies whether the API key can be used by callers - true or false | `bool` | `true` | no |
| <a name="input_api_key_name"></a> [api\_key\_name](#input\_api\_key\_name) | The name of the API key - string value | `string` | `null` | no |
| <a name="input_api_key_value"></a> [api\_key\_value](#input\_api\_key\_value) | The value of the API key. We highly suggest using a SOP-encrypted value. If not specified, it will be automatically generated by AWS on creation - string value | `string` | `null` | no |
| <a name="input_api_template_file"></a> [api\_template\_file](#input\_api\_template\_file) | API Gateway [OpenAPI 3](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions.html) template file | `any` | n/a | yes |
| <a name="input_api_template_vars"></a> [api\_template\_vars](#input\_api\_template\_vars) | Variables required in the OpenAPI template file | `map(any)` | `{}` | no |
| <a name="input_capsule_env"></a> [capsule\_env](#input\_capsule\_env) | The environment this queue belongs to (dev, staging, production). | `string` | n/a | yes |
| <a name="input_capsule_service"></a> [capsule\_service](#input\_capsule\_service) | The service that owns this API gateway. | `string` | n/a | yes |
| <a name="input_capsule_team"></a> [capsule\_team](#input\_capsule\_team) | The team that owns this API gateway. | `string` | n/a | yes |
| <a name="input_endpoint_configuration_type"></a> [endpoint\_configuration\_type](#input\_endpoint\_configuration\_type) | The endpoint configuration type (EDGE, or REGIONAL). | `string` | `"EDGE"` | no |
| <a name="input_lambda_names"></a> [lambda\_names](#input\_lambda\_names) | List of lambda names that this API Gateway will need to invoke | `list(string)` | `[]` | no |
| <a name="input_name"></a> [name](#input\_name) | Optional identifier to add at the end of the gateway name. | `string` | `null` | no |
| <a name="input_quota_limit"></a> [quota\_limit](#input\_quota\_limit) | The maximum number of requests that can be made in a given time period - number. | `number` | `null` | no |
| <a name="input_quota_offset"></a> [quota\_offset](#input\_quota\_offset) | The number of requests subtracted from the given limit in the initial time period - number | `number` | `null` | no |
| <a name="input_quota_period"></a> [quota\_period](#input\_quota\_period) | The time period in which the limit applies. Valid values are "DAY", "WEEK" or "MONTH" - string | `string` | `null` | no |
| <a name="input_stage_name"></a> [stage\_name](#input\_stage\_name) | A list of names the stages you wish to provision - string value | `string` | n/a | yes |
| <a name="input_throttle_burst_limit"></a> [throttle\_burst\_limit](#input\_throttle\_burst\_limit) | The API request burst limit, the maximum rate limit over a time ranging from one to a few seconds, depending upon whether the underlying token bucket is at its full capacity. | `number` | `null` | no |
| <a name="input_throttle_rate_limit"></a> [throttle\_rate\_limit](#input\_throttle\_rate\_limit) | The API request steady-state rate limit. | `number` | `null` | no |
| <a name="input_usage_plan_name"></a> [usage\_plan\_name](#input\_usage\_plan\_name) | The name of your usage plan | `string` | `null` | no |
| <a name="input_vanta_contains_ephi"></a> [vanta\_contains\_ephi](#input\_vanta\_contains\_ephi) | Vanta specific tag to specify if the resource contains PHI - true or false | `bool` | n/a | yes |
| <a name="input_vanta_description"></a> [vanta\_description](#input\_vanta\_description) | Vanta specific tag to specify the purpose of resource - string value | `string` | n/a | yes |
| <a name="input_vanta_owner"></a> [vanta\_owner](#input\_vanta\_owner) | Vanta specific tag to identify resource owner - string | `string` | n/a | yes |
| <a name="input_vanta_user_data"></a> [vanta\_user\_data](#input\_vanta\_user\_data) | Vanta specific tag to specify if the resource will contain user data - true or false | `bool` | n/a | yes |
| <a name="input_vanta_user_data_stored"></a> [vanta\_user\_data\_stored](#input\_vanta\_user\_data\_stored) | Vanta specific tag to specify the type of data the resource transacts/stores - string value | `string` | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_deployment_execution_arn"></a> [deployment\_execution\_arn](#output\_deployment\_execution\_arn) | Deployment execution ARN |
| <a name="output_deployment_id"></a> [deployment\_id](#output\_deployment\_id) | Deployment id |
| <a name="output_deployment_invoke_url"></a> [deployment\_invoke\_url](#output\_deployment\_invoke\_url) | Deployment invoke url |
| <a name="output_rest_api_id"></a> [rest\_api\_id](#output\_rest\_api\_id) | API Gateway id |
| <a name="output_rest_api_name"></a> [rest\_api\_name](#output\_rest\_api\_name) | API Gateway name |
| <a name="output_usage_plan_api_key_id"></a> [usage\_plan\_api\_key\_id](#output\_usage\_plan\_api\_key\_id) | Usage plan API Key ID |
<!-- END_TF_DOCS -->
